# Zed Editor Theme - Usage Guide

## Overview

The iNiR theme system automatically generates a **Material You** based theme for the Zed editor that matches your current wallpaper colors.

### Features

- **Automatic theme generation** - Theme updates when you change your wallpaper
- **Dark & Light variants** - Two complete themes based on your wallpaper
- **Material You colors** - Uses Google's Material Design 3 color system
- **Full syntax highlighting** - Colors for all programming language elements
- **Terminal integration** - Terminal colors match your system terminal
- **Complete UI styling** - Borders, panels, buttons, scrollbars, etc.

---

## Quick Start

### Automatic Generation

The theme is generated automatically when:
1. **You change your wallpaper** - The theme system detects change and regenerates
2. **During installation** - Initial theme is created when you install iNiR

### Manual Generation

If you need to regenerate the theme manually:

```bash
# The theme is automatically generated when you change your wallpaper
# No manual regeneration needed - it's handled by applycolor.sh
```

---

## Using Theme in Zed

### Step 1: Ensure Theme File Exists

```bash
ls -la ~/.config/zed/themes/ii-theme.json
```

You should see:
```
-rw-r--r-- 1 admin admin 26416 Feb 23 20:40 ii-theme.json
```

### Step 2: Open Zed Settings

Launch Zed and open settings by:
- **Keyboard shortcut**: Press `Ctrl+,`
- **Menu**: Click `Zed` â†’ `Settings`

### Step 3: Select the Theme

1. Click on **Themes** in the settings sidebar
2. Find the **Theme** dropdown
3. Select one of:
   - **"iNiR Dark"** - For dark mode editing
   - **"iNiR Light"** - For light mode editing

The theme applies immediately!

### Step 4: Restart Zed (if needed)

If the theme doesn't appear in the dropdown:
1. Close Zed completely
2. Reopen Zed
3. Check the Themes section again

Zed needs to scan for new themes on startup.

---

## Configuration

### Enable/Disable Zed Theme Generation

Edit your iNiR config file:
```bash
~/.config/illogical-impulse/config.json
```

Add or modify:
```json
{
  "appearance": {
    "wallpaperTheming": {
      "enableZed": true
    }
  }
}
```

- `true` (default) - Generate Zed theme automatically
- `false` - Skip Zed theme generation

### Theme File Location

**Generated theme file**:
```
~/.config/zed/themes/ii-theme.json
```

**Log file** (for troubleshooting):
```
~/.local/state/quickshell/user/generated/code_editor_themes.log
```

---

## Color Sources

The theme is built from two sources:

### 1. Material You Colors (`colors.json`)

Location: `~/.local/state/quickshell/user/generated/colors.json`

Contains:
- `primary` - Main accent color
- `secondary` - Secondary accent
- `tertiary` - Tertiary accent (usually used for success/green)
- `error` - Error color
- `surface` - Main background
- `surface_container` - Elevated backgrounds
- `on_surface` - Text color
- `outline` - Border color
- And more...

### 2. Terminal Colors (`material_colors.scss`)

Location: `~/.local/state/quickshell/user/generated/material_colors.scss`

Contains:
- `term0` to `term7` - Standard terminal colors
- `term8` to `term15` - Bright terminal variants

Both files are automatically generated by the wallpaper theming system (matugen).

---

## Theme Structure

The generated theme file contains:

```json
{
  "$schema": "https://zed.dev/schema/themes/v0.2.0.json",
  "name": "iNiR Material",
  "author": "iNiR Theme System",
  "themes": [
    {
      "name": "iNiR Dark",
      "appearance": "dark",
      "style": { ... }
    },
    {
      "name": "iNiR Light",
      "appearance": "light",
      "style": { ... }
    }
  ]
}
```

### Dark Theme ("iNiR Dark")

Uses darker variants of the Material You colors:
- Dark backgrounds (`surface`, `surface_container`)
- Light text (`on_surface`)
- Accent colors directly from wallpaper

### Light Theme ("iNiR Light")

Uses inverted/brightened variants:
- Light backgrounds (lightened `surface`)
- Dark text (darkened `on_surface`)
- Adjusted accent colors for contrast

---

## Troubleshooting

### Theme doesn't appear in Zed's theme list

**Symptom**: After changing wallpaper or running `setup update`, the theme isn't in the dropdown.

**Solutions**:

1. **Restart Zed completely**
   ```bash
   # Close Zed
   # Reopen it
   ```

2. **Check if theme file exists**
   ```bash
   ls -la ~/.config/zed/themes/ii-theme.json
   ```
   If missing, regenerate: `./scripts/colors/code/zed/regen-theme.sh`

3. **Verify JSON is valid**
   ```bash
   python3 -m json.tool ~/.config/zed/themes/ii-theme.json
   ```
   Should print formatted JSON without errors.

4. **Check the log file**
   ```bash
   cat ~/.local/state/quickshell/user/generated/code_editor_themes.log
   ```
   Look for error messages.

5. **Verify color files exist**
   ```bash
   ls ~/.local/state/quickshell/user/generated/material_colors.scss
   ls ~/.local/state/quickshell/user/generated/colors.json
   ```
   If missing, run wallpaper theming first.

6. **Check Zed config directory**
   ```bash
   ls -la ~/.config/zed/
   ```
   Should contain a `themes/` subdirectory.

### Theme is generated but colors look wrong

**Symptom**: Theme appears in Zed but colors don't match your wallpaper.

**Solutions**:

1. **Regenerate theme manually**
   ```bash
   ./scripts/colors/code/zed/regen-theme.sh
   ```

2. **Check if color files are up-to-date**
   ```bash
   stat ~/.local/state/quickshell/user/generated/material_colors.scss
   stat ~/.local/state/quickshell/user/generated/colors.json
   ```
   Files should be recent (changed when you last ran wallpaper theming).

3. **Run full update**
   ```bash
   ./setup update
   ```

### Theme generation fails

**Symptom**: Regeneration script exits with error.

**Solutions**:

1. **Check Python installation**
   ```bash
   python3 --version
   ```
   Should print version 3.x.x

2. **Check virtual environment**
   ```bash
   ls -la ~/.local/state/quickshell/.venv/bin/python3
   ```

3. **Verify file permissions**
   ```bash
   ls -la ~/.config/zed/themes/
   ```
   You should have write permissions.

4. **Read the error message**
   The regen-theme.sh script provides detailed error messages. Follow the hints.

---

## Advanced Customization

### Modifying Color Mappings

To customize how Material You colors map to Zed theme properties:

1. Edit the theme generator:
   ```bash
   ./scripts/colors/generate_terminal_configs.py
   ```

2. Find the `generate_zed_config()` function (around line 1144)

3. Modify the `build_zed_dark_theme()` or `build_zed_light_theme()` functions

4. Regenerate theme:
   ```bash
   ./scripts/colors/code/zed/regen-theme.sh
   ```

### Creating Custom Theme Files

If you want to create a completely custom theme:

1. Copy the generated theme:
   ```bash
   cp ~/.config/zed/themes/ii-theme.json ~/.config/zed/themes/my-custom-theme.json
   ```

2. Edit the file with your preferred editor
3. Change the `"name"` field to your theme name
4. Select it in Zed settings

**Note**: Custom themes won't be automatically updated when you change wallpapers.

---

## Integration Details

### Automatic Triggers

The theme regeneration is triggered by:

1. **Wallpaper changes**
   - `switchwall.sh` detects wallpaper change
   - Calls `applycolor.sh`
   - `applycolor.sh` calls `apply_code_editors()`
   - `apply_code_editors()` generates Zed theme

2. **System updates**
   - `./setup update` runs
   - Calls Zed theme generation directly
   - Ensures theme is up-to-date with latest code

3. **System installation**
   - `./setup install` runs
   - Generates initial theme after setup

### File Locations Summary

| File/Directory | Location | Purpose |
|----------------|----------|---------|
| **Generated theme** | `~/.config/zed/themes/ii-theme.json` | Zed theme file |
| **Theme log** | `~/.local/state/quickshell/user/generated/code_editor_themes.log` | Generation log |
| **Material colors** | `~/.local/state/quickshell/user/generated/colors.json` | Material You palette |
| **Terminal colors** | `~/.local/state/quickshell/user/generated/material_colors.scss` | Terminal color palette |
| **Regen script** | `./scripts/colors/code/zed/regen-theme.sh` | Manual regeneration |
| **Generator script** | `./scripts/colors/generate_terminal_configs.py` | Python theme generator |

---

## FAQ

**Q: Do I need to regenerate the theme every time I change my wallpaper?**

A: No, it's automatic! The theme system detects wallpaper changes and regenerates the theme automatically.

**Q: Can I use the theme if I don't have Zed installed yet?**

A: Yes! The theme file will be generated and stored. When you install Zed later, the theme will be available.

**Q: What if I want different colors than my wallpaper?**

A: You have two options:
1. Create a custom theme file based on the generated one
2. Manually edit the generated theme and disable automatic regeneration in config

**Q: Why are there two themes (Dark and Light)?**

A: Both are generated to match both Zed appearance modes. You can switch between them in Zed settings without regenerating.

**Q: The theme appears but syntax colors are wrong for my language**

A: The theme uses Zed's syntax highlighting categories that work across most languages. For language-specific customization, create a custom theme.

**Q: Can I use this with other code editors?**

A: Currently, Zed is the only code editor with full Material You integration in iNiR. However, VSCode and other editors can use the same color scheme via other theme tools.

---

## Getting Help

If you encounter issues not covered here:

1. **Check the log file**:
   ```bash
   cat ~/.local/state/quickshell/user/generated/code_editor_themes.log
   ```

2. **Run the doctor**:
   ```bash
   ./setup doctor
   ```

3. **Roll back if needed**:
   ```bash
   ./setup rollback
   ```

4. **Report issues** on the iNiR GitHub repository with:
   - Steps to reproduce
   - Log file content
   - Theme file (if not too large)

---

## Credits

- **Material You Design System** - Google's adaptive color system
- **Zed Editor** - High-performance code editor (https://zed.dev)
- **matugen** - Material You color generator
- **iNiR Theme System** - Integration and automation

---

## Version History

| Version | Date | Changes |
|---------|------|----------|
| 1.0.0 | 2025-02-23 | Initial Zed theme integration |

---